import{f as B,E as T,F as z,G as s,aJ as N,bS as X,a2 as w,bT as Q,bU as V,bV as Z,bW as ee,B as k,aX as W,C as e,aU as Y,aT as _,bi as U,bD as H,bX as ie,bY as ae,a1 as te}from"./index-Beof0WWD.js";import{O as D,g as A,f as n}from"./PWAIcon-DxAi7YRA.js";import{r as q,i as F,R as O,B as S,M as se,P as ne,d as j}from"./explorer-DGVTHNNb.js";var $={},G=F;Object.defineProperty($,"__esModule",{value:!0});var L=$.default=void 0,E=G(B),re=G(q()),le=(0,re.default)(E.default.createElement("g",null,E.default.createElement("path",{d:"M21 11H6.83l3.58-3.59L9 6l-6 6 6 6 1.41-1.41L6.83 13H21z"})),"KeyboardBackspace");L=$.default=le;var R={},J=F;Object.defineProperty(R,"__esModule",{value:!0});var K=R.default=void 0,P=J(B),oe=J(q()),ce=(0,oe.default)(P.default.createElement("g",null,P.default.createElement("circle",{cx:"12",cy:"19",r:"2"}),P.default.createElement("path",{d:"M10 3h4v12h-4z"})),"PriorityHigh");K=R.default=ce;const de=b=>({primeBox:{display:"flex",flexDirection:"column"},primeContainer:{borderBottom:`1px solid ${s.white10}`,color:"#fff"},primeBlock:{marginTop:10},overviewBlock:{marginTop:20},overviewBlockError:{marginTop:15,padding:10,display:"flex",alignItems:"center",backgroundColor:"rgba(255, 0, 0, 0.2)","& p":{display:"inline-block",marginLeft:10}},overviewBlockSuccess:{marginTop:15,padding:10,alignItems:"center",backgroundColor:"rgba(0, 255, 0, 0.2)","& p":{display:"inline-block",marginLeft:10,"&:first-child":{fontWeight:600}}},overviewBlockLoading:{marginTop:15,padding:10,display:"flex",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.2)","& p":{display:"inline-block",marginLeft:10}},overviewBlockDisabled:{marginTop:12,borderRadius:12,padding:"8px 12px",display:"flex",alignItems:"center",backgroundColor:s.white08,"& p":{display:"inline-block",marginLeft:10},"& a":{color:"white"}},manageItem:{marginLeft:10,"& span":{color:s.white70,fontSize:"0.9em"}},buttons:{marginTop:10,background:s.white,borderRadius:18,color:s.grey900,textTransform:"none",width:220,"&:hover":{backgroundColor:s.white70,color:s.grey900},"&:disabled":{backgroundColor:s.white70,color:s.grey900},"&:disabled:hover":{backgroundColor:s.white70,color:s.grey900}},cancelButton:{color:s.white,background:"transparent",border:`1px solid ${s.grey500}`,"&:hover":{backgroundColor:s.white10,color:s.white},"&:disabled":{backgroundColor:"transparent",color:s.grey500},"&:disabled:hover":{backgroundColor:"transparent",color:s.grey500}},modal:{position:"absolute",padding:b.spacing.unit*2,width:b.spacing.unit*50,maxWidth:"90%",left:"50%",top:"40%",transform:"translate(-50%, -50%)","& p":{marginTop:10}},closeButton:{marginTop:10,float:"right",backgroundColor:s.grey200,color:s.white,"&:hover":{backgroundColor:s.grey400}},cancelModalButton:{width:170,marginTop:10,backgroundColor:s.grey200,color:s.white,"&:hover":{backgroundColor:s.grey400},"&:disabled":{backgroundColor:s.grey400},"&:disabled:hover":{backgroundColor:s.grey400}},cancelError:{backgroundColor:"rgba(255, 0, 0, 0.3)",marginTop:10,padding:10,"& p":{margin:0}},cancelSuccess:{backgroundColor:"rgba(0, 255, 0, 0.3)",marginTop:10,padding:10,"& p":{margin:0}},paymentElement:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",maxWidth:450}});class pe extends B.Component{constructor(i){super(i),this.state={error:null,cancelError:null,cancelModal:!1,canceling:!1,stripeStatus:null,windowWidth:window.innerWidth},this.cancelPrime=this.cancelPrime.bind(this),this.fetchStripeSession=this.fetchStripeSession.bind(this),this.gotoUpdate=this.gotoUpdate.bind(this),this.fetchSubscription=this.fetchSubscription.bind(this),this.onResize=this.onResize.bind(this)}componentDidMount(){this.componentDidUpdate({},{}),this.mounted=!0}componentDidUpdate(i,r){var l,g;const{subscription:t}=this.props,{stripeStatus:a}=this.state;!i.stripeSuccess&&this.props.stripeSuccess&&this.setState({stripeStatus:{sessionId:this.props.stripeSuccess,loading:!0,paid:null}},this.fetchStripeSession),(t!=null&&t.user_id&&((l=r.stripeStatus)==null?void 0:l.paid)!=="paid"&&(a==null?void 0:a.paid)==="paid"||(a==null?void 0:a.paid)==="paid"&&!((g=i.subscription)!=null&&g.user_id)&&(t!=null&&t.user_id))&&this.props.dispatch(N("prime_paid",{plan:t.plan}))}componentWillUnmount(){this.mounted=!1}cancelPrime(){this.setState({canceling:!0}),this.props.dispatch(N("prime_cancel",{plan:this.props.subscription.plan})),X(this.props.dongleId).then(i=>{i.success?(this.setState({canceling:!1,cancelError:null,cancelSuccess:"Cancelled subscription."}),this.fetchSubscription()):i.error?this.setState({canceling:!1,cancelError:i.description}):this.setState({canceling:!1,cancelError:"Could not cancel due to unknown error. Please try again."})}).catch(i=>{w(i,{fingerprint:"primemanage_cancel_prime"}),this.setState({canceling:!1,cancelError:"Could not cancel due to unknown error. Please try again."})})}async gotoUpdate(){this.props.dispatch(N("prime_stripe_update",{plan:this.props.subscription.plan}));try{const i=await Q(this.props.dongleId);window.location=i.url}catch(i){console.error(i),w(i,{fingerprint:"prime_goto_stripe_update"})}}async fetchStripeSession(){const{dongleId:i}=this.props,{stripeStatus:r}=this.state;if(!(!r||!this.mounted))try{const a=(await V(i,r.sessionId)).payment_status;this.setState({stripeStatus:{...r,paid:a,loading:a!=="paid"}}),a==="paid"?this.fetchSubscription(!0):setTimeout(this.fetchStripeSession,2e3)}catch(t){console.error(t),w(t,{fingerprint:"prime_fetch_stripe_session"})}}async fetchSubscription(i=!1){const{dongleId:r}=this.props;if(this.mounted)try{const t=await Z(r);t.user_id?this.props.dispatch(ee(r,t)):setTimeout(()=>this.fetchSubscription(!0),2e3)}catch(t){t.message&&t.message.indexOf("404")===0?i&&setTimeout(()=>this.fetchSubscription(!0),2e3):(console.error(t),w(t,{fingerprint:"prime_fetch_subscription"}))}}onResize(i){this.setState({windowWidth:i})}render(){var c,y;const{dispatch:i,dongleId:r,subscription:t,classes:a,device:l}=this.props,{windowWidth:g,stripeStatus:m}=this.state,o=t&&t.user_id;if(!o&&!m)return null;let d,f,C,p,u;o&&(d=k(t.subscribed_at?t.subscribed_at*1e3:0).format("MMMM D, YYYY"),f=k(t.next_charge_at?t.next_charge_at*1e3:0).format("MMMM D, YYYY"),C=k(t.cancel_at?t.cancel_at*1e3:0).format("MMMM D, YYYY"),p=t.plan==="nodata"?"Lite":"Standard",u=t.plan==="nodata"?"(without data plan)":"(with data plan)");const h=!!(o&&t.cancel_at&&t.cancel_at<=t.next_charge_at),v=W(l),x=g>520?36:16,I=g<514?{width:"100%"}:{};return e.jsxs(e.Fragment,{children:[e.jsx(O,{onResize:this.onResize}),e.jsxs("div",{className:a.primeBox,children:[e.jsx("div",{className:a.primeContainer,style:{padding:`8px ${x}px`},children:e.jsx(A,{"aria-label":"Go Back",onClick:()=>i(Y(!1)),children:e.jsx(L,{})})}),e.jsxs("div",{className:a.primeContainer,style:{padding:`16px ${x}px`},children:[e.jsx(n,{variant:"title",children:"comma prime"}),m&&e.jsxs(e.Fragment,{children:[m.paid!=="paid"&&e.jsxs("div",{className:a.overviewBlockLoading,children:[e.jsx(_,{size:19,style:{color:s.white}}),e.jsx(n,{children:"Waiting for confirmed payment"})]}),m.paid==="paid"&&!o&&e.jsxs("div",{className:a.overviewBlockLoading,children:[e.jsx(_,{size:19,style:{color:s.white}}),e.jsx(n,{children:"Processing subscription"})]}),!!(m.paid==="paid"&&o)&&e.jsxs("div",{className:a.overviewBlockSuccess,children:[e.jsx(n,{children:"comma prime activated"}),t.is_prime_sim&&e.jsx(n,{children:"Connectivity will be enabled as soon as activation propagates to your local cell tower. Rebooting your device may help."})]})]}),e.jsxs("div",{className:a.overviewBlock,children:[e.jsx(n,{variant:"subheading",children:"Device"}),e.jsxs("div",{className:a.manageItem,children:[e.jsx(n,{variant:"body2",children:v}),e.jsx(n,{variant:"caption",className:a.deviceId,children:`(${l.dongle_id})`})]})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:a.overviewBlock,children:[e.jsx(n,{variant:"subheading",children:"Plan"}),e.jsxs(n,{className:a.manageItem,children:[p,e.jsx("span",{children:` ${u}`})]})]}),e.jsxs("div",{className:a.overviewBlock,children:[e.jsx(n,{variant:"subheading",children:"Joined"}),e.jsx(n,{className:a.manageItem,children:d})]}),!h&&e.jsxs("div",{className:a.overviewBlock,children:[e.jsx(n,{variant:"subheading",children:"Next payment"}),e.jsx(n,{className:a.manageItem,children:f})]}),h&&e.jsxs("div",{className:a.overviewBlock,children:[e.jsx(n,{variant:"subheading",children:"Subscription end"}),e.jsx(n,{className:a.manageItem,children:C})]}),e.jsxs("div",{className:a.overviewBlock,children:[e.jsx(n,{variant:"subheading",children:"Amount"}),e.jsx(n,{className:a.manageItem,children:`$${(t.amount/100).toFixed(2)}`})]}),this.state.error&&e.jsxs("div",{className:a.overviewBlockError,children:[e.jsx(U,{}),e.jsx(n,{children:this.state.error})]}),e.jsxs("div",{className:`${a.overviewBlock} ${a.paymentElement}`,children:[e.jsx(S,{className:a.buttons,style:I,onClick:this.gotoUpdate,disabled:!o||h&&!((c=l.eligible_features)!=null&&c.prime_data)&&t.plan==="data",children:h?"Renew subscription":"Update payment method"}),!h&&e.jsx(S,{className:`${a.buttons} ${a.cancelButton} primeCancel`,style:I,onClick:()=>this.setState({cancelModal:!0}),disabled:!o,children:"Cancel subscription"})]}),o&&t.requires_migration&&e.jsxs("div",{className:a.overviewBlockDisabled,children:[e.jsx(K,{}),e.jsxs(n,{children:["Your prime subscription will be canceled on May 15th unless you replace the SIM card in your device. A new SIM card can be ordered from the",e.jsx("a",{href:"https://comma.ai/shop/comma-prime-sim",children:"shop"}),". Use discount code SIMSWAP at checkout to receive a free SIM card."]})]}),h&&!((y=l.eligible_features)!=null&&y.prime_data)&&t.plan==="data"&&e.jsxs("div",{className:a.overviewBlockDisabled,children:[e.jsx(H,{}),e.jsxs(n,{children:["Standard comma prime discontinued for",ie(l.device_type)]})]})]})]})]}),e.jsx(se,{open:this.state.cancelModal,onClose:()=>this.setState({cancelModal:!1}),children:e.jsxs(ne,{className:a.modal,children:[e.jsx(n,{variant:"title",children:"Cancel prime subscription"}),this.state.cancelError&&e.jsx("div",{className:a.cancelError,children:e.jsx(n,{children:this.state.cancelError})}),this.state.cancelSuccess&&e.jsx("div",{className:a.cancelSuccess,children:e.jsx(n,{children:this.state.cancelSuccess})}),e.jsx(n,{children:`Device: ${v} (${r})`}),e.jsx(n,{children:"We're sorry to see you go."}),e.jsx(n,{children:"Your subscription will be cancelled immediately and can be resumed at any time."}),e.jsx(S,{variant:"contained",className:`${a.cancelModalButton} primeModalCancel`,onClick:this.cancelPrime,disabled:!!(this.state.cancelSuccess||this.state.canceling),children:this.state.canceling?e.jsx(_,{size:19,style:{color:s.white}}):"Cancel subscription"}),e.jsx(S,{variant:"contained",className:`${a.closeButton} primeModalClose`,onClick:()=>this.setState({cancelModal:!1}),children:"Close"})]})})]})}}const he=D({dongleId:"dongleId",device:"device",subscription:"subscription"}),me=T(he)(z.withStyles(de)(pe)),ue=()=>({primeBox:{display:"flex",flexDirection:"column",maxWidth:430,color:"#fff"},primeHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",maxWidth:410,flexDirection:"row"},headerDevice:{display:"flex",alignItems:"center","& :first-child":{marginRight:8}},primeBlock:{marginTop:10},moreInfoContainer:{"& p":{display:"inline"},"& button":{display:"inline",marginLeft:"15px"}},deviceId:{color:"#525E66"},leftMargin:{marginLeft:10},deviceBlock:{marginLeft:10,"& aside":{display:"inline",marginRight:5},"& span":{display:"inline"}},overviewBlockError:{borderRadius:12,marginTop:8,padding:"8px 12px",display:"flex",alignItems:"center",backgroundColor:"rgba(255, 0, 0, 0.2)","& p":{display:"inline-block",marginLeft:10}},overviewBlockDisabled:{marginTop:12,borderRadius:12,padding:"8px 12px",display:"flex",alignItems:"center",backgroundColor:s.white08,"& p":{display:"inline-block",marginLeft:10},"& a":{color:s.white}},chargeText:{fontSize:13},buttons:{width:"100%",height:42,borderRadius:21,background:s.white,color:s.grey900,textTransform:"none","&:hover":{backgroundColor:s.white70,color:s.grey900},"&:disabled":{backgroundColor:s.white70,color:s.grey900},"&:disabled:hover":{backgroundColor:s.white70,color:s.grey900}},checkList:{marginLeft:12},checkListItem:{display:"flex",alignItems:"center",marginBottom:4,"& svg":{alignSelf:"flex-start",fontSize:21},"& p":{fontSize:14,margin:"0 0 0 14px"},"& span":{color:s.white70,fontSize:12}},learnMore:{"& a":{color:"white"}},primeTitle:{margin:"0 12px"},planBox:{display:"flex",flexDirection:"row",justifyContent:"space-around",height:140},planBoxContainer:{position:"relative",marginLeft:-6,marginRight:-6},plan:{cursor:"pointer",WebkitTapHighlightColor:"transparent",width:160,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around",border:"2px solid transparent",backgroundColor:s.white10,padding:"8px 0",borderRadius:18,fontWeight:600,textAlign:"center",position:"relative","&:first-child":{marginRight:2},"&:last-child":{marginLeft:2},"& p":{margin:0}},planName:{fontSize:"1.2rem"},planPrice:{fontSize:"1.5rem"},planSubtext:{fontWeight:"normal",fontSize:"0.8rem"},planDisabled:{backgroundColor:s.white05,color:s.white40,cursor:"default"},planInfoLoading:{backgroundColor:s.white03,color:s.white20,cursor:"default"},planLoading:{position:"absolute",top:0,width:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:140,"& p":{marginTop:10,fontSize:"0.9rem"}}});class ge extends B.Component{constructor(i){super(i),this.state={error:null,loadingCheckout:!1,selectedPlan:null,windowWidth:window.innerWidth,windowHeight:window.innerHeight},this.gotoCheckout=this.gotoCheckout.bind(this),this.trialClaimable=this.trialClaimable.bind(this),this.dataPlanAvailable=this.dataPlanAvailable.bind(this),this.onResize=this.onResize.bind(this)}componentDidMount(){this.componentDidUpdate({})}componentDidUpdate(i){const{stripeCancelled:r,subscribeInfo:t}=this.props;if(!i.stripeCancelled&&r&&this.setState({error:"Checkout cancelled"}),this.state.selectedPlan===null&&t){const a=this.dataPlanAvailable()?"data":"nodata";this.setState({selectedPlan:a})}}onResize(i,r){this.setState({windowWidth:i,windowHeight:r})}async gotoCheckout(){const{dispatch:i,dongleId:r,subscribeInfo:t}=this.props;this.setState({loadingCheckout:!0});try{const{selectedPlan:a}=this.state,l=await ae(r,t.sim_id,a);i(N("prime_checkout",{plan:a})),window.location=l.url}catch(a){console.error(a),w(a,{fingerprint:"prime_goto_stripe_checkout"})}}dataPlanAvailable(){var t;const{device:i,subscribeInfo:r}=this.props;return!i||!r?null:!!((t=i.eligible_features)!=null&&t.prime_data&&r&&r.sim_id&&r.is_prime_sim&&r.sim_usable!==!1&&["blue","magenta_new","webbing"].includes(r.sim_type))}trialClaimable(){const{subscribeInfo:i}=this.props,{selectedPlan:r}=this.state;return i?r==="data"?!!i.trial_end_data:r==="nodata"?!!i.trial_end_nodata:!!(i.trial_end_data&&i.trial_end_nodata):null}render(){var y;const{classes:i,dispatch:r,device:t,subscribeInfo:a}=this.props,{windowWidth:l,windowHeight:g,error:m,loadingCheckout:o,selectedPlan:d}=this.state;let f=null;if(d&&this.trialClaimable()){let M=null;d==="data"?M=k(a.trial_end_data*1e3).format("MMMM D"):d==="nodata"&&(M=k(a.trial_end_nodata*1e3).format("MMMM D")),f=`Your first charge will be on ${M}, then monthly thereafter.`}const C=l>520?{margin:"18px 24px"}:{margin:"6px 12px"},p=l>520?{marginTop:24}:{marginTop:8},u=l>520?{paddingLeft:7,paddingRight:7}:{paddingLeft:8,paddingRight:8},h={border:"2px solid white"},v=a?"":i.planInfoLoading,x=!a||!this.dataPlanAvailable(),I=g>600?{height:140}:{height:110};let c;return a&&x&&((y=t.eligible_features)!=null&&y.prime_data?!a.sim_id&&a.device_online?c="Standard plan not available, no SIM was detected. Ensure SIM is securely inserted and try again.":a.sim_id?a.is_prime_sim?["blue","magenta_new","webbing"].includes(a.sim_type)?a.sim_usable===!1&&a.sim_type==="blue"?c=["Standard plan not available, SIM has been canceled and is therefore no longer usable, new SIM cards are available in the ",e.jsx("a",{href:"https://comma.ai/shop/comma-prime-sim",children:"shop"},1)]:a.sim_usable===!1&&(c=["Standard plan not available, SIM is no longer usable, new SIM cards are available in the ",e.jsx("a",{href:"https://comma.ai/shop/comma-prime-sim",children:"shop"},1)]):c=["Standard plan not available, old SIM type detected, new SIM cards are available in the ",e.jsx("a",{href:"https://comma.ai/shop/comma-prime-sim",children:"shop"},1)]:c="Standard plan not available, detected a third-party SIM.":c="Standard plan not available, device could not be reached. Connect device to the internet and try again.":c="Standard plan is not available for your device."),e.jsxs("div",{className:i.primeBox,style:C,children:[e.jsx(O,{onResize:this.onResize}),e.jsxs("div",{className:i.primeHeader,children:[e.jsx(A,{"aria-label":"Go Back",onClick:()=>r(Y(!1)),children:e.jsx(L,{})}),e.jsxs("div",{className:i.headerDevice,children:[e.jsx(n,{variant:"body2",children:W(t)}),e.jsx(n,{variant:"caption",className:i.deviceId,children:`(${t.dongle_id})`})]})]}),e.jsx("h2",{className:i.primeTitle,children:"comma prime"}),e.jsx("div",{style:p,children:e.jsxs("div",{className:i.checkList,children:[e.jsxs("div",{className:i.checkListItem,style:u,children:[e.jsx(j,{}),e.jsx("p",{children:"24/7 connectivity"})]}),e.jsxs("div",{className:i.checkListItem,style:u,children:[e.jsx(j,{}),e.jsx("p",{children:"Take pictures remotely"})]}),e.jsxs("div",{className:i.checkListItem,style:u,children:[e.jsx(j,{}),e.jsx("p",{children:"1 year storage of drive videos"})]}),e.jsxs("div",{className:i.checkListItem,style:u,children:[e.jsx(j,{}),e.jsx("p",{children:"Simple SSH for developers"})]}),e.jsxs("div",{className:i.checkListItem,style:u,children:[e.jsx(j,{}),e.jsx("p",{children:"Turn-by-turn navigation"})]})]})}),e.jsxs("div",{className:i.planBoxContainer,style:p,children:[e.jsxs("div",{className:i.planBox,style:I,children:[e.jsxs("div",{className:`${i.plan} ${v}`,style:d==="nodata"?h:{},onClick:a?()=>this.setState({selectedPlan:"nodata"}):null,children:[e.jsx("p",{className:i.planName,children:"lite"}),e.jsx("p",{className:i.planPrice,children:"$10/month"}),e.jsxs("p",{className:i.planSubtext,children:["bring your own",e.jsx("br",{}),"sim card"]})]}),e.jsxs("div",{className:`${i.plan} ${x?i.planDisabled:""} ${v}`,style:d==="data"?h:{},onClick:x?null:()=>this.setState({selectedPlan:"data"}),children:[e.jsx("p",{className:i.planName,children:"standard"}),e.jsx("p",{className:i.planPrice,children:"$24/month"}),e.jsxs("p",{className:i.planSubtext,children:["including data plan",e.jsx("br",{}),"only offered in the U.S."]})]})]}),!a&&e.jsxs("div",{className:i.planLoading,children:[e.jsx(_,{size:38,style:{color:s.white}}),e.jsx(n,{children:"Fetching SIM data"})]})]}),c&&e.jsxs("div",{className:i.overviewBlockDisabled,style:p,children:[e.jsx(H,{}),e.jsx(n,{children:c})]}),e.jsx("div",{style:p,children:e.jsxs(n,{className:i.learnMore,children:["Learn more about comma prime from our ",e.jsx("a",{target:"_blank",href:"https://comma.ai/connect#faq",rel:"noreferrer",children:"FAQ"})]})}),m&&e.jsxs("div",{className:i.overviewBlockError,children:[e.jsx(U,{}),e.jsx(n,{children:m})]}),e.jsx("div",{style:p,children:e.jsx(S,{className:`${i.buttons} gotoCheckout`,onClick:()=>this.gotoCheckout(),disabled:!!(!a||o||!d),children:o?e.jsx(_,{size:19}):this.trialClaimable()?"Claim trial":"Go to checkout"})}),f&&e.jsx("div",{style:p,children:e.jsx(n,{className:i.chargeText,children:f})})]})}}const be=D({dongleId:"dongleId",device:"device",subscribeInfo:"subscribeInfo"}),fe=T(be)(z.withStyles(ue)(ge)),xe=b=>{let i,r;if(window.location){const l=te.parse(window.location.search);i=l.stripe_cancelled,r=l.stripe_success}const{device:t,profile:a}=b;return a?!t.is_owner&&!a.superuser?e.jsx(n,{children:"No access"}):t.prime||r?e.jsx(me,{stripeSuccess:r}):e.jsx(fe,{stripeCancelled:i}):null},ve=D({subscription:"subscription",device:"device",profile:"profile"}),Se=T(ve)(xe);export{Se as default};
//# sourceMappingURL=index-DvY2LsV0.js.map
